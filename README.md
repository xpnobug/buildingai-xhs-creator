# BuildingAI å°çº¢ä¹¦å›¾æ–‡åˆ›ä½œæ’ä»¶

AI é©±åŠ¨çš„å°çº¢ä¹¦å›¾æ–‡åˆ›ä½œæ’ä»¶ï¼Œæ”¯æŒå¤§çº²ç”Ÿæˆã€å›¾ç‰‡ç”Ÿæˆã€ç‰ˆæœ¬ç®¡ç†ã€ç§¯åˆ†è®¡è´¹ç­‰åŠŸèƒ½ã€‚

## æ’ä»¶ä¿¡æ¯

| å±æ€§ | å€¼ |
|------|-----|
| **ç‰ˆæœ¬** | 1.0.0 |
| **æ ‡è¯†ç¬¦** | buildingai-xhs-creator |
| **å…¼å®¹å¹³å°** | â‰¥25.0.0 |
| **ä½œè€…** | couei |

## åŠŸèƒ½ç‰¹æ€§

- âœ¨ **AI æ™ºèƒ½å¤§çº²ç”Ÿæˆ** - æ ¹æ®ä¸»é¢˜è‡ªåŠ¨ç”Ÿæˆå†…å®¹å¤§çº²
- ğŸ¨ **AI å›¾ç‰‡ç”Ÿæˆ** - SSE æµå¼é€šä¿¡å®æ—¶æ¨é€è¿›åº¦
- ğŸ“Š **ç‰ˆæœ¬å†å²ç®¡ç†** - æ”¯æŒæŸ¥çœ‹å’Œæ¢å¤å†å²ç‰ˆæœ¬
- ğŸ’° **ç§¯åˆ†è®¡è´¹ç³»ç»Ÿ** - å…è´¹æ¬¡æ•° + ç§¯åˆ†æ‰£å‡
- ğŸ”„ **å¢é‡é‡ç»˜** - ä»…é‡ç»˜ä¿®æ”¹é¡µé¢èŠ‚çœç§¯åˆ†
- ğŸ“ **è‡ªå®šä¹‰æ¨¡æ¿** - æ”¯æŒè‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿
- ğŸ›¡ï¸ **ç†”æ–­ä¿æŠ¤** - é˜²æ­¢ AI æœåŠ¡é›ªå´©
- ğŸ’¾ **Redis ç¼“å­˜** - çƒ­ç‚¹æ•°æ®ç¼“å­˜ä¼˜åŒ–

---

## ç›®å½•ç»“æ„

```
buildingai-xhs-creator/
â”œâ”€â”€ manifest.json               # æ’ä»¶æ¸…å•
â”œâ”€â”€ package.json                # ä¾èµ–é…ç½®
â”œâ”€â”€ nuxt.config.ts              # Nuxt é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # åç«¯ (NestJS)
â”‚   â”‚   â”œâ”€â”€ db/                 # æ•°æ®åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/       # å®ä½“å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ migrations/     # è¿ç§»è„šæœ¬
â”‚   â”‚   â”‚   â””â”€â”€ seeds/          # ç§å­æ•°æ®
â”‚   â”‚   â””â”€â”€ modules/xhs-creator/
â”‚   â”‚       â”œâ”€â”€ controllers/    # 8 ä¸ªæ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ services/       # 19 ä¸ªæœåŠ¡
â”‚   â”‚       â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ prompts/        # AI æç¤ºè¯æ¨¡æ¿
â”‚   â”‚       â”œâ”€â”€ guards/         # å®ˆå«
â”‚   â”‚       â”œâ”€â”€ pipes/          # ç®¡é“
â”‚   â”‚       â””â”€â”€ interfaces/     # æ¥å£å®šä¹‰
â”‚   â””â”€â”€ web/                    # å‰ç«¯ (Nuxt/Vue)
â”‚       â”œâ”€â”€ pages/              # é¡µé¢
â”‚       â”œâ”€â”€ components/         # ç»„ä»¶
â”‚       â”œâ”€â”€ stores/             # çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ services/           # API æœåŠ¡
â”‚       â””â”€â”€ composables/        # ç»„åˆå‡½æ•°
â””â”€â”€ data/                       # é™æ€æ•°æ®
```

---

## æ•°æ®åº“å®ä½“

| å®ä½“ | è¯´æ˜ |
|------|------|
| `XhsTask` | ç”Ÿæˆä»»åŠ¡ |
| `XhsImage` | å›¾ç‰‡è®°å½• |
| `XhsImageHistory` | å›¾ç‰‡ç‰ˆæœ¬å†å² |
| `XhsProvider` | AI æä¾›å•†é…ç½® |
| `XhsConfig` | æ’ä»¶é…ç½® |
| `XhsUserUsage` | ç”¨æˆ·ä½¿ç”¨ç»Ÿè®¡ |

---

## åç«¯æ¶æ„

### æ§åˆ¶å™¨ (8ä¸ª)

| æ§åˆ¶å™¨ | èŒè´£ |
|--------|------|
| `OutlineController` | å¤§çº²ç”Ÿæˆ API |
| `ImageController` | å›¾ç‰‡ç”Ÿæˆ API (SSE) |
| `TaskController` | ä»»åŠ¡ç®¡ç† API |
| `ProviderController` | AI æä¾›å•†ç®¡ç† |
| `XhsConfigController` | åå°é…ç½® API |
| `XhsConfigWebController` | å‰å°é…ç½® API |
| `TaskConsoleController` | ç®¡ç†åå°ä»»åŠ¡ API |
| `BalanceController` | ä½™é¢/ç§¯åˆ†æŸ¥è¯¢ API |

### æ ¸å¿ƒæœåŠ¡

| æœåŠ¡ | èŒè´£ |
|------|------|
| `OutlineService` | AI å¤§çº²ç”Ÿæˆ |
| `ImageService` | AI å›¾ç‰‡ç”Ÿæˆã€ç‰ˆæœ¬ç®¡ç† |
| `BillingService` | ç§¯åˆ†è®¡è´¹ã€å…è´¹æ¬¡æ•° |
| `XhsConfigService` | é…ç½®è¯»å†™ |
| `ImageVersionService` | ç‰ˆæœ¬å†å²ç®¡ç† |
| `GeneratorResolverService` | AI ç”Ÿæˆå™¨è§£æ |
| `RedisCacheService` | Redis ç¼“å­˜ |
| `CircuitBreakerService` | ç†”æ–­ä¿æŠ¤ |

---

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 1. å¤§çº²ç”Ÿæˆ

```
ç”¨æˆ·è¾“å…¥ä¸»é¢˜ â†’ AI æ–‡æœ¬æ¨¡å‹ç”Ÿæˆ â†’ è§£æä¸ºé¡µé¢ç»“æ„ â†’ ä¿å­˜ä»»åŠ¡
```

### 2. å›¾ç‰‡ç”Ÿæˆ (SSE)

```
SSE è¿æ¥ â†’ éå†é¡µé¢ â†’ æ‰£å‡ç§¯åˆ† â†’ AI ç”Ÿæˆå›¾ç‰‡ â†’ æ¨é€è¿›åº¦ â†’ ä¿å­˜ç‰ˆæœ¬
```

### 3. è®¡è´¹ç³»ç»Ÿ

```
æ£€æŸ¥å…è´¹æ¬¡æ•° â†’ æœ‰åˆ™ä½¿ç”¨ / æ— åˆ™æ‰£ç§¯åˆ† â†’ æ‰§è¡Œç”Ÿæˆ â†’ å¤±è´¥åˆ™å›é€€ç§¯åˆ†
```

**ç§¯åˆ†é…ç½®**ï¼š
- å¤§çº²ç”Ÿæˆ: `config.outlinePower`
- å°é¢å›¾: `config.coverImagePower` (é»˜è®¤ 80)
- å†…å®¹å›¾: `config.contentImagePower` (é»˜è®¤ 40)

---

## å‰ç«¯æ¶æ„

### çŠ¶æ€ç®¡ç† (Pinia)

```typescript
interface XhsCreatorState {
    taskId: string | null;
    topic: string;
    userImages: string[];
    outline: string;
    pages: Page[];
    isGeneratingOutline: boolean;
    isGeneratingImages: boolean;
}
```

### é¡µé¢ç»“æ„

| é¡µé¢ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| `index.vue` | `/` | ä¸»åˆ›ä½œé¡µé¢ |
| `history.vue` | `/history` | å†å²è®°å½• |
| `console/` | `/console/*` | ç®¡ç†åå° |

---

## API ç«¯ç‚¹

### å‰å° API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/outline/generate` | ç”Ÿæˆå¤§çº² |
| GET | `/images/generate` | ç”Ÿæˆå›¾ç‰‡ (SSE) |
| GET | `/images/regenerate` | å•å¼ é‡ç»˜ (SSE) |
| GET | `/task/:id` | è·å–ä»»åŠ¡è¯¦æƒ… |
| GET | `/task/list` | ä»»åŠ¡åˆ—è¡¨ |
| DELETE | `/task/:id` | åˆ é™¤ä»»åŠ¡ |
| GET | `/balance` | æŸ¥è¯¢ç§¯åˆ†ä½™é¢ |

### ç®¡ç†åå° API

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/config` | è·å–é…ç½® |
| PUT | `/config` | æ›´æ–°é…ç½® |
| GET | `/task/list` | ä»»åŠ¡åˆ—è¡¨ |

---

## å¼€å‘å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼
pnpm dev              # åŒæ—¶å¯åŠ¨å‰åç«¯
pnpm dev:web          # ä»…å¯åŠ¨å‰ç«¯
pnpm dev:api          # ä»…å¯åŠ¨åç«¯

# æ„å»º
pnpm build:publish    # æ„å»ºå‘å¸ƒåŒ…

# ä»£ç æ£€æŸ¥
pnpm lint             # ESLint æ£€æŸ¥
pnpm lint:fix         # è‡ªåŠ¨ä¿®å¤
pnpm check-types      # TypeScript ç±»å‹æ£€æŸ¥
```
